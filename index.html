<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App UPK178 - Rastreo Harold</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; margin: 0; background: #121212; color: white; }
        #map { height: 50vh; width: 100%; border-bottom: 3px solid #ff9800; }
        .info-panel { padding: 15px; background: #1e1e1e; border-radius: 15px; margin: 10px; border: 1px solid #333; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; font-size: 16px; cursor: pointer; margin-top: 10px; }
        .btn-start { background: #28a745; color: white; }
        .btn-stop { background: #dc3545; color: white; display: none; }
        .btn-ws { background: #25D366; color: white; text-decoration: none; display: block; text-align: center; }
        .vibras { color: #ff9800; text-align: center; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="info-panel">
        <h3 style="color:#ff9800; margin:0; text-align:center;">üöö MONITOREO UPK 178</h3>
        <p style="margin:5px 0;"><strong>CONDUCTOR:</strong> 3103620459</p>
        <p style="margin:5px 0;"><strong>DUE√ëO (HAROLD):</strong> 3117700431</p>
        <p style="margin:5px 0;"><strong>ESTADO:</strong> <span id="status" style="color:red">APAGADO</span></p>
        
        <button id="start" class="btn btn-start" onclick="encender()">‚ñ∂Ô∏è INICIAR RECORRIDO</button>
        <button id="stop" class="btn btn-stop" onclick="apagar()">‚èπÔ∏è DETENER RASTREO</button>
        <a id="ws" href="#" target="_blank" class="btn btn-ws">üì≤ ENVIAR UBICACI√ìN A HAROLD</a>
        <div class="vibras">‚ú® Vibras Positivas ‚ú®</div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCTdSrjNaXauHAkWE0HLBJOcgBaEh5E6Gw",
        authDomain: "upk178-d8cbd.firebaseapp.com",
        databaseURL: "https://upk178-d8cbd-default-rtdb.firebaseio.com",
        projectId: "upk178-d8cbd",
        storageBucket: "upk178-d8cbd.firebasestorage.app",
        messagingSenderId: "406972511555",
        appId: "1:406972511555:web:90828ea0fe17fe332a2bf6"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref('monitoreo_upk178');

    var map = L.map('map').setView([7.9789, -75.1991], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    var marker = L.marker([7.9789, -75.1991]).addTo(map);

    let watchID;
    function encender() {
        if (navigator.geolocation) {
            document.getElementById('start').style.display='none';
            document.getElementById('stop').style.display='block';
            document.getElementById('status').innerText="EN VIVO";
            document.getElementById('status').style.color="green";
            watchID = navigator.geolocation.watchPosition(pos => {
                const lat = pos.coords.latitude;
                const lng = pos.coords.longitude;
                db.set({lat, lng, hora: new Date().toLocaleTimeString()});
                document.getElementById('ws').href = `https://wa.me/573117700431?text=UPK178 llego a tienda: https://www.google.com/maps?q=${lat},${lng}`;
            }, null, {enableHighAccuracy:true});
        }
    }
    function apagar() {
        navigator.geolocation.clearWatch(watchID);
        location.reload();
    }
    db.on('value', snap => {
        const d = snap.val();
        if(d) { marker.setLatLng([d.lat, d.lng]); map.panTo([d.lat, d.lng]); }
    });
</script>
</body>
</html>
