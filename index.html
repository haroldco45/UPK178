<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rastreo UPK 178 - En Vivo</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 75vh; width: 100%; position: relative; }
        body { margin: 0; font-family: sans-serif; background: #1a1a1a; color: white; }
        .panel { padding: 15px; text-align: center; }
        .btn-ws { background: #25D366; color: white; padding: 12px 25px; text-decoration: none; 
                  border-radius: 25px; font-weight: bold; display: inline-block; margin-top: 10px; }
        .info { font-size: 14px; margin-bottom: 5px; color: #00ffcc; }
    </style>
</head>
<body>

<div id="map"></div>

<div class="panel">
    <div class="info">游뚴 <b>UPK 178</b> | Cond: 3103620459 | <span id="recorrido">0 km</span> recorridos</div>
    <div id="reloj" style="font-size: 12px; margin-bottom: 10px;">Cargando hora de Colombia...</div>
    <a id="link-ws" href="#" target="_blank" class="btn-ws">游 ENVIAR MI UBICACI칍N ACTUAL</a>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // 1. Configuraci칩n Inicial (Caucasia)
    var map = L.map('map').setView([7.9789, -75.1991], 16);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    var carMarker = L.marker([7.9789, -75.1991]).addTo(map).bindPopup("UPK 178 - En movimiento");
    
    // 2. L칤nea de recorrido (Polyline)
    var rutaCaminada = L.polyline([], {color: '#00ffcc', weight: 5}).addTo(map);

    // 3. FUNCI칍N DE SEGUIMIENTO REAL
    if ("geolocation" in navigator) {
        navigator.geolocation.watchPosition(function(position) {
            var lat = position.coords.latitude;
            var lng = position.coords.longitude;
            var nuevaPos = [lat, lng];

            // Mover el marcador y centrar el mapa autom치ticamente
            carMarker.setLatLng(nuevaPos);
            map.panTo(nuevaPos);

            // Dibujar el rastro por donde va pasando el carro
            rutaCaminada.addLatLng(nuevaPos);

            // Actualizar Datos y WhatsApp
            var horaCol = new Date().toLocaleString("es-CO", {timeZone: "America/Bogota"});
            document.getElementById('reloj').innerText = "칔ltimo reporte: " + horaCol;
            
            var msj = `*UPK 178 EN MOVIMIENTO*\n游늸 Ver recorrido: https://www.google.com/maps?q=${lat},${lng}\n游 ${horaCol}`;
            document.getElementById('link-ws').href = `https://wa.me/573117700431?text=${encodeURIComponent(msj)}`;

        }, function(error) {
            console.error("Error de GPS: ", error);
        }, {
            enableHighAccuracy: true, // Usa el GPS de m치xima precisi칩n
            maximumAge: 0,
            timeout: 5000
        });
    } else {
        alert("Tu celular no soporta GPS");
    }
</script>
</body>
</html>
